language: node_js
node_js:
  - "15.2.1"
dist: xenial  
sudo: required
services:
  - docker

env:
  global:
    - DOCKER_TLS_VERIFY="1"
    - DOCKER_HOST="tcp://40.83.140.149:2376"
    - DOCKER_CERT_PATH="./azure"
    - DOCKER_MACHINE_NAME="dronuts2021-team-3"

install:
  - npm install
script:
  - npm run lint
  - (cd backend && npm test)
  - (cd frontend && npm test)
  - docker-compose build --force-rm

deploy:
  skip_cleanup: true
  provider: script
  script: docker-compose up -d --force-recreate --remove-orphans
  on:
    branch: main
